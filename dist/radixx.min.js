/*!
  * @lib: Radixx
  * @version: 0.0.2
  * @author: Ifeora Okechukwu
  * @created: 30/12/2016
  *
  * All Rights Reserved 2016 - 2017.
  * Use, reproduction, distribution, and modification of this code is subject to the terms and
  * conditions of the MIT license, available at http://www.opensource.org/licenses/mit-license.php
  *
  * @desc: Implementation of Facebooks' Flux Architecture with a Twist.
  */
!function(n,t){var i="undefined";typeof module==i||!module.exports?typeof define==i||!define.amd?window.Radixx=t(n):define("Radixx",function(){return t(n)}):module.exports=t(n)}(this,function(n,t){var s=!1,u=!0,h="constructor",f="function",c="object",i=null;function e(){this.toString=function(){return"[object Hub]"}}var r={}.hasOwnProperty,o=[].slice,l=function(n,u,f){f===t&&(f=i);for(var e in n)r.call(n,e)&&u.call(f,n[e],e)},a=function(n,t,i){return function(){var r=o.call(arguments);return n.apply(i,t.concat(r))}};return Array.prototype.forEach=Array.prototype.forEach||function(n,t){return l(this,n,t)},Function.prototype.bind=Function.prototype.bind||function(n){return a(this,[].slice(arguments,1),n)},Object.keys=Object.keys||function(n){var s="toString",t,u,l,e,i,o;if(typeof n==c||typeof n==f){t=[];for(u in fuc)r.call(fuc,u)&&t.push(u);if(l=!ob.propertyIsEnumerable(s),e=[s,"toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","prototypeIsEnumerable",h],l)for(i=0;i<e.length;i++)o=e[i],r.call(fuc,o)&&t.push(o);return t}},Store=function(){var n=["graph-ql"],t={};return function(n){var t=this,i=t;t.getTitle=function(){return n},t.toJSON=function(){return{title:n}},t.reactjs={},t.reactjs.mixin=function(){var n=this;return n.willMount=function(){i.setChangeListener(this.forceUpdate.bind(this))},n.willUnMount=function(){i.unsetChangeListener(this.forceUpdate.bind(this))},n.getProps=function(){return i.getState()},{componentWillMount:n.willMount,componentWillUnMount:n.willUnMount,getDefaultProps:n.getProps}}.call(t.reactjs),t.toString=function(){return"[object RadixxStore]"}}}(),Action=function(){return function(n){this.getId=function(){return n},this.toJSON=function(){return{id:n}},this.toString=function(){return"[object RadixxAction]"}}}(),futuresStates={STARTED:0,AWAIT:1,RESOLVED:2,REJECTED:3},formatOptions=function(n){var t={},i=String(n).split(",");return i.forEach(function(n){t[n]=u}),t.savedData=!1,t},Routines=function(n){var e=formatOptions(n),y,p,v,w,b,r=[],h=e.multiple&&[],c=function(n){for(e.savedData=!c.$decline&&e.save&&n,w=u,b=u,v=y||0,p=r.length,y=0;v<p;v++)setTimeout(a(r[v],n[1],n[0]),20);if(b=s,h&&h.length)return c(h.shift());c.$decline=s,e.savedData&&e.unpack&&(r.length=0)};return{add:function(){var n=0,t;return r&&(t=r.length,function i(t){t.forEach(function(t){var u=typeof t;u==f?n=r.push(t):!!t&&t.length&&typeof t!="string"&&i(o.call(t))})}(o.call(arguments)),w&&e.join&&(y=t,p=n,c.$decline=u,c(e.savedData),this.disable())),n},hasFn:function(n){var t=s;return l(r,function(i){typeof n==f&&n===i&&(t=u)},this),t},hasList:function(){return!!r},fireWith:function(){if(r&&(!w||h)){var n=arguments.length&&o.call(arguments)||[i,0];b?h.push(n):c(n)}},disable:function(){e.savedData||(r=h=t)}}},Futures=function(){var a="join",t={resolve:["done","RESOLVED",Routines([a,"save"])],reject:["fail","REJECTED",Routines([a,"save"])],notify:["progress","AWAIT",Routines([a,"multiple"])]},n=this,h=Object.keys(t),l=function(i,r,f){var e=i!="notify";return!r.length&&!f?t[i][2].fireWith:f?function(){return n.state>=0&&n.state<=1&&t[i][2].add.apply(n,o.call(arguments)),n}:function(){if(n.state>=0&&n.state<=1&&(n.state=futuresStates[t[i][1]]),t[i][2].fireWith(n===this?n:this,[].slice.call(arguments)),e){t[r[0]][2].disable(),t[r[1]][2].disable();switch(i){case"reject":case"resolve":n.state=futuresStates[t[i][1]]}}return u}},v=0,y=h.slice(),s,e={};for(s in t)r.call(t,s)&&(h.splice(v++,1),n[s]=l(s,h),n[s+"With"]=l(s,[]),e[t[s][0]]=l(s,[],u),h=y.slice());return e.state=futuresStates.STARTED,e.always=function(){return this.done.apply(n,arguments).fail.apply(n,arguments)},e.promise=function(n){if(n&&typeof n==c&&!n.length){for(var t in e)r.call(e,t)&&(n[t]=e[t]);return n}return e},e.then=function(){var i,r=[].slice.call(arguments);return r.forEach(function(r,u){r=typeof r==f&&r,n[t[h[u]][0]](function(){var n;try{n=r&&r.apply(this,arguments)}catch(t){n=this.reject(t)}finally{n&&typeof n.promise==f&&(i=n.promise())}})}),n.promise(i)},e.isResolved=function(){return!t.reject[2].hasList()},e.isRejected=function(){return!t.resolve[2].hasList()},e.pipe=e.then,e.promise(n),Futures.STARTED=futuresStates.STARTED,Futures.AWAITING=futuresStates.AWAIT,Futures.RESOLVED=futuresStates.RESOLVED,Futures.REJECTED=futuresStates.REJECTED,l=y=s=v=i,n instanceof Futures?n:new Futures},Observable=function(n){var rt="swapCallback",tt="setQuerySchema",d="setPayloadDefinition",nt="getQuerySchema",it="getState",g="unsetChangeListener",k="setChangeListener";function o(){n.addEventListener?n.addEventListener("storage",ot,s):n.document.attachEvent&&n.document.attachEvent("onstorage",ot)}var b=i,e=n.sessionStorage,st=n.document.documentMode||0,p=[],v={},t={},a={},ut=[],w={},ft=function(n){var t="__proto__";if("getPrototypeOf"in Object)return Object.getPrototypeOf(n);if(t in n){if(!r.call(n,t))return n.__proto__}else if(h in n&&!r.call(n,h))return n.constructor.prototype;return n},l=function(n){return n===void 0},ht=function(n,t,i,r){var u,f;if(n.$$history.length!=1||n.$$initData||(n.$$initData=n.$$history[0]),n.$$history=n.$$history.slice(0,n.$$historyIndex+1),u=n.call(t,i,r),!u){throw new TypeError("Radixx: Application State unavailable after signal to Dispatcher");return}f=n.$$history.push(u),n.$$historyIndex++,n.$$history.length>15&&n.$$history.unshift()},et=function(t){if(l(t)||t==="null")return i;try{return n.JSON?JSON.parse(t):new Function("return "+t)()}catch(r){return String(t)}},ct=function(n){l(n)&&(n=i);try{return JSON.stringify(n)}catch(t){return String(n)}},lt=function(){for(var i={},t,n=0;n<e.length;n++)t=e.key(n),i[t]=et(e.getItem(t));return i},y=function(n){var t=this;return t.put=function(t){return e.remainingSpace&&st===8&&(e.$$key=n,e.constructor.$$currentStoreType=e),e.setItem(n,ct(t)),t},t.get=function(){return et(e.getItem(n))||i},t.del=function(){return e.removeItem(n)},t},at=function(){var t=i,f=lt(),n,u;for(n in a)r.call(a,n)&&(t=a[n],t.isResolved()||t.resolve(),delete a[n]);ut.length=0;for(u in p)r.call(p,u)&&p[u].call(i,f)},ot=function(r){var o,u,f;if(r=r||n.event,e.remainingSpace&&r.source===i&&"$$key"in e&&(r.key=e.$$key,r.storageArea=e.constructor.$$currentStoreType),r.storageArea===e&&(u=r.key,!l(t[u])))for(o=t[u].$$store_listeners,f=0;f<o.length;f++)o[f].call(v[u],i)};return o.prototype.getRegistration=function(n){return r.call(t,n)?t[n]:{}},o.prototype.register=function(n,i,f){if(r.call(t,n)){if("$$history"in t[n]&&typeof i.$$history=="undefined"){if(!v[n]){throw new Error("Radixx: Cannot Overwrite existing store registration");return}i.$$history=t[n].$$history,i.$$historyIndex=t[n].$$historyIndex,i.$$store_listeners=t[n].$$store_listeners,t[n]=i}}else i.$$store_listeners=[],i.$$history=[!f?[]:f],i.$$historyIndex=0,t[n]=i;return u},o.prototype.watch=function(n){p.push(n)},o.prototype.setStoreListener=function(n,i){var r=n.getTitle();l(t[r])||typeof i==f&&(v[r]=n,t[r].$$store_listeners.push(i))},o.prototype.unsetStoreListener=function(n,i){var r=n.getTitle(),u;l(t[r])||typeof i==f&&(u=t[r].$$store_listeners.indexOf(i),t[r].$$store_listeners.splice(u,1))},o.prototype.signal=function(i){if(n.setTimeout(at,0),i.source in w)for(var u in t)r.call(t,u)&&ht(t[u],this.queueing,i,new y(u))},o.prototype.unregister=function(n){var r,u;l(t[n])||(r=t[n],u=v[n],r.$$store_listeners.length=0,r.$$store_listeners=i,r.$$historyIndex=i,r.$$history.length=0,r.$$history=i,delete t[n],r=i,u&&typeof u.destroy==f&&(u.destroy(),delete v[n],u=i))},o.prototype.queueing={await:function(n,t){for(var r=-1,e=n.length+r,u=i;++r<e;)u=ut.indexOf(n[r])>-1?a[n[r]]:a[n[r]]=new Futures,typeof t==f&&u.then(t)}},{getInstance:function(){return b===i&&(b=new o),b},setActionVectors:function(n,t){var e=ft(n),o=this.getInstance(),f=i,u;for(u in t)r.call(t,u)&&(f=t[u],e[u]=this.createActionInterface(o,f));return n},createStoreInterface:function(n,t){return function(){var f=this,r,e,o=arguments.length?arguments[0]:i,s;return t==k?n.setStoreListener(f,o):t==g?n.unsetStoreListener(f,o):t==it?(e=new y(f.getTitle()),s=e.get(),e=i,s):(t=="destroy"&&(e=new y(f.getTitle()),e.del(),e=i),t=="hydrate")?!!o&&typeof o!=c?void 0:n.signal({source:t,actionType:o.actionLabel,actionData:o.payload}):t==nt?{}:t==d?u:t==tt?u:t=="canUndo"?(r=n.getRegistration(f.getTitle()),r.$$historyIndex!=0):t==rt?n.register(f.getTitle(),o):t=="canRedo"?(r=n.getRegistration(f.getTitle()),r.$$historyIndex!==r.$$history.length-1):t=="undo"?(r=n.getRegistration(f.getTitle()),e=new y(f.getTitle()),f.canUndo()&&(--r.$$historyIndex,e.put(r.$$history[r.$$historyIndex]),r=i,e=i),u):t=="redo"?(r=n.getRegistration(f.getTitle()),e=new y(f.getTitle()),f.canRedo()&&(++r.$$historyIndex,e.put(r.$$history[r.$$historyIndex]),r=i,e=i),u):void 0}},createActionInterface:function(n,t){return function(i){var r=this.getId();l(w[r])||w[r].actionTypes.push(t),n.signal({source:r,actionType:t,actionData:i})}},watchDispatcher:function(n){var t=this.getInstance();t.watch(n)},configureDispatcher:function(){},registerAction:function(){var n=Math.random().toString(16).substr(2,13);return w[n]={actionTypes:[]},n},makeAggregator:function(){return{notifyAllStores:function(){}}},setStoreObserver:function(n,t){var e,r;if(typeof t!=f)return i;var s=ft(n),o=this.getInstance(),h=n.getTitle(),u=i;for(o.register(h,t),e=[k,g,it,nt,tt,d,"canRedo","canUndo",rt,"undo","redo","hydrate","destroy"],r=0;r<e.length;r++)u=e[r],s[u]=this.createStoreInterface(o,u)}}}(n),e.prototype.constructor=e,e.prototype.config=function(n){Observable.configureDispatcher(n)},e.prototype.onDispatch=function(n){Observable.watchDispatcher(n)},e.prototype.requestAggregator=function(){return Observable.makeAggregator()},e.prototype.createAction=function(n){function t(){Action.apply(this,o.call(arguments))}var i=new t(Observable.registerAction());return Observable.setActionVectors(i,n)},e.prototype.createStore=function(n,t){function r(){Store.apply(this,o.call(arguments))}var i=new r(n);return Observable.setStoreObserver(i,t),i},new e})